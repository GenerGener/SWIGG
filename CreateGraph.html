<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>01. Create Graph. Vivagraph SVG tutorial.</title>
    <script type="text/javascript" src="../../dist/vivagraph.js"></script>
    <script type="text/javascript">

        function main() {

            var readSingleFile = (e) => {

                var reader = new FileReader()
                reader.onloadend = (e) => {
                    //console.log(reader)
                    var jsonObj = JSON.parse(reader.result)

                    nodeObj = jsonObj.gexf.graph.nodes.node
                    edgeObj = jsonObj.gexf.graph.edges.edge

                    // Step 1. We create a graph object.
                    var graph = Viva.Graph.graph();

                    var graphics = Viva.Graph.View.svgGraphics(),
                    nodeSize = 12;

                    var createMarker = function(id) {
                    return Viva.Graph.svg('marker')
                               .attr('id', id)
                               .attr('viewBox', "0 0 10 10")
                               .attr('refX', "10")
                               .attr('refY', "5")
                               .attr('markerUnits', "strokeWidth")
                               .attr('markerWidth', "10")
                               .attr('markerHeight', "5")
                               .attr('orient', "auto");
                    },

                    marker = createMarker('Triangle');
                    marker.append('path').attr('d', 'M 0 0 L 10 5 L 0 10 z');

                    // Marker should be defined only once in <defs> child element of root <svg> element:
                    var defs = graphics.getSvgRoot().append('defs');
                    defs.append(marker);

                    var geom = Viva.Graph.geom();

                    graphics.link(function(link){
                    // Notice the Triangle marker-end attribe:
                    return Viva.Graph.svg('path')
                           .attr('stroke', 'gray')
                           .attr('marker-end', 'url(#Triangle)');
                    }).placeLink(function(linkUI, fromPos, toPos) {
                    // Here we should take care about
                    //  "Links should start/stop at node's bounding box, not at the node center."

                    // For rectangular nodes Viva.Graph.geom() provides efficient way to find
                    // an intersection point between segment and rectangle
                    var toNodeSize = nodeSize,
                        fromNodeSize = nodeSize;

                    var from = geom.intersectRect(
                            // rectangle:
                                    fromPos.x - fromNodeSize / 2, // left
                                    fromPos.y - fromNodeSize / 2, // top
                                    fromPos.x + fromNodeSize / 2, // right
                                    fromPos.y + fromNodeSize / 2, // bottom
                            // segment:
                                    fromPos.x, fromPos.y, toPos.x, toPos.y)
                               || fromPos; // if no intersection found - return center of the node

                    var to = geom.intersectRect(
                            // rectangle:
                                    toPos.x - toNodeSize / 2, // left
                                    toPos.y - toNodeSize / 2, // top
                                    toPos.x + toNodeSize / 2, // right
                                    toPos.y + toNodeSize / 2, // bottom
                            // segment:
                                    toPos.x, toPos.y, fromPos.x, fromPos.y)
                                || toPos; // if no intersection found - return center of the node

                    var data = 'M' + from.x + ',' + from.y +
                               'L' + to.x + ',' + to.y;

                    linkUI.attr("d", data);
                    });


                    // Step 2. We add nodes and edges to the graph:
                    edgeObj.map((el, idx) => {

                        graph.addLink(el['@source'], el['@target']);
                        console.log(el['@source'])
                    })


                    // Step 3. Render the graph.
                    //var renderer = Viva.Graph.View.renderer(graph);
                    //renderer.run();

                    // All is ready. Render the graph:
                    var renderer = Viva.Graph.View.renderer(graph, {
                        graphics : graphics
                        });
                    renderer.run();
                }
                reader.readAsText(e.target.files[0])
            }

            document.getElementById('fileinput').addEventListener('change', readSingleFile, false);



            /*// Step 1. We create a graph object.
            var graph = Viva.Graph.graph();

            // Step 2. We add nodes and edges to the graph:
            graph.addLink("-4076200875182589025", "-4076200875182589025");
            graph.addLink(2, 3);

            // Step 3. Render the graph.
            var renderer = Viva.Graph.View.renderer(graph);
            renderer.run();*/
        }
    </script>
    <style type="text/css" media="screen">
        html, body, svg { width: 100%; height: 100%;}
    </style>
</head>
<body onload='main()'>
<input type="file" id="fileinput" />
</body>
</html>
